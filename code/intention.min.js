/*!
 * intention.js Library v0.9.6.2
 * http://intentionjs.com/
 *
 * Copyright 2011, 2013 Dowjones and other contributors
 * Released under the MIT license
 *
 */
(function(g,d){"function"===typeof define&&define.amd?define("intention",["jquery","underscore"],d):g.Intention=d(g.jQuery,g._)})(this,function(g,d){var h=function(h){return d.extend(this,h,{_listeners:{},contexts:[],elms:g(),axes:{},priority:[]})};h.prototype={responsive:function b(a,c){var f="",e;for(e=0;5>e;e++)f+="abcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(36*Math.random())];f={matcher:function(c,a){return c===a.name},measure:d.identity,ID:f};!1===d.isObject(c)&&(c={});if(d.isArray(a)&&
d.isArray(a[0].contexts))d.each(a,function(c){b.apply(this,c)},this);else return!1===d.isArray(a)&&d.isObject(a)?c=a:c.contexts=a,c=d.extend({},f,c),this.on(c.ID,d.bind(function(a){this.axes=this._contextualize(c.ID,a.context,this.axes);this._respond(this.axes,this.elms)},this)),f={ID:[c.ID],current:null,contexts:c.contexts,respond:d.bind(this._responder(c.ID,c.contexts,c.matcher,c.measure),this)},this.axes[c.ID]=f,this.axes.__keys__=this.priority,this.priority.unshift(c.ID),f},elements:function(b){b||
(b=document);g("[data-intent],[intent],[data-in],[in]",b).each(d.bind(function(a,c){this.add(g(c))},this));return this},add:function(b,a){var c;a||(a={});b.each(d.bind(function(b,e){var k=!1;this.elms.each(function(c,a){if(e===a)return k=!0,!1});!1===k&&(c=this._fillSpec(d.extend(a,this._attrsToSpec(e.attributes))),this._makeChanges(g(e),c,this.axes),this.elms.push({elm:e,spec:c}))},this));return this},remove:function(b){var a=this.elms;b.each(function(c,b){a.each(function(c,d){if(b===d.elm)return a.splice(c,
1),!1})});return this},is:function(b){var a=this.axes;return d.some(a.__keys__,function(c){return b===a[c].current})},on:function(b,a){void 0===this._listeners[b]&&(this._listeners[b]=[]);this._listeners[b].push(a);return this},off:function(b,a){if(d.isArray(this._listeners[b])){var c=this._listeners[b],f;for(f=0;c.length;f++)if(c[f]===a){c.splice(f,1);break}}return this},_responder:function(b,a,c,f){var e;return function(){var k=f.apply(this,arguments);d.every(a,function(a){if(c(k,a)){if(void 0===
e||a.name!==e.name)e=a,this._emitter(d.extend({},{_type:e.name},e),this)._emitter({_type:b,context:e.name},this);return!1}return!0},this);return this}},_emitter:function(b){"string"===typeof b&&(b={_type:b});b.target||(b.target=this);if(!b._type)throw Error(b._type+" is not a supported event.");if(d.isArray(this._listeners[b._type])){var a=this._listeners[b._type],c;for(c=0;c<a.length;c++)a[c].call(this,b)}return this},_fillSpec:function(b){var a=function(c){d.each(b,c)},c={};a(function(a){d.isObject(a)&&
d.each(a,function(a,b){c[b]=""})});a(function(a,e){d.isObject(a)&&(b[e]=d.extend({},c,a))});return b},_attrsToSpec:function(b){var a={},c=/^(data-)?(in|intent)-([a-zA-Z0-9][_a-zA-Z0-9]*)-([A-Za-z:-]+)/,f=/^(data-)?(in|intent)-([a-zA-Z0-9][_a-zA-Z0-9]*)$/;d.each(b,function(b){var d=b.name.match(c);if(null!==d){var d=d.slice(-2),l=d[0],g=a,h=a[l]||{};h[d[1]]=b.value;g[l]=h;a=g}else f.test(b.name)&&(a["_"+b.name.match(f)[3]]=b.value)});return a},_resolveSpecs:function(b,a){var c={},f=["append","prepend",
"before","after"];d.each(b,function(b){d.each(a[b],function(a,b){if("class"===b)c[b]||(c[b]=[]),c[b]=d.union(c[b],a.split(" "));else if((void 0===c.move||""===c.move.value)&&-1!==g.inArray(b,f))c.move={value:a,placement:b};else if(void 0===c[b]||""===c[b])c[b]=a},this)},this);return c},_currentContexts:function(b){var a=[];d.each(b.__keys__,function(c){null!==b[c].current&&a.push(b[c].current)});return a},_removeClasses:function(b,a){var c=[];d.each(a.__keys__,function(f){var e=a[f],k=!1;void 0!==
b["_"+e.ID]&&(k=!0);d.each(e.contexts,function(a){a.name!==e.current&&(k&&c.push(a.name),a=b[a.name],void 0!==a&&void 0!==a["class"]&&(a=a["class"].split(" "),void 0!==a&&(c=d.union(c,a))))},this)},this);return c},_contextConfig:function(b,a){var c=this._resolveSpecs(this._currentContexts(a),b,a);d.each(b,function(b,e){var k;this._axis_test_pattern.test(e)&&(k=e.match(this._axis_match_pattern)[1],a[k]&&(c["class"]=d.union(c["class"],[a[k].current,b])))},this);return c},_makeChanges:function(b,a,c){if(!1===
d.isEmpty(c)){var f=this._contextConfig(a,c);d.each(f,function(e,f){if("move"===f){if(a.__placement__!==e.placement||a.__move__!==e.value)g(e.value)[e.placement](b),a.__placement__=e.placement,a.__move__=e.value}else if("class"===f){var h=b.attr("class")||"",h=d.union(e,d.difference(h.split(" "),this._removeClasses(a,c)));b.attr("class",h.join(" "))}else b.attr(f,e)},this)}return b},_respond:function(b,a){a.each(d.bind(function(a,d){var e=g(d.elm);this._makeChanges(e,d.spec,b);e.trigger("intent",
this)},this))},_contextualize:function(b,a,c){c[b].current=a;return c},_axis_test_pattern:/^_[^_]/,_axis_match_pattern:/^_([a-zA-Z0-9][_a-zA-Z0-9]*)/};return h});
