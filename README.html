<h1>intention.js</h1>
<p>DOM Manipulation via html attribute specification</p>
<h2>Why Intention.js</h2>
<p>The technology for dealing with responsive design is all over the place. Media queries, often-hacky-javascript, and convoluted HTML. Intention.js allows you to make all of the changes to HTML in the HTML itself. Intention.js is a way to describe the differences of an HTML document from one context to another. </p>
<p>What should the classes of an element be on mobile vs tablet? Where should your advertising code get placed when you&#39;re on a desktop? Does the page require an alternate slideshow widget on touch enabled devices? These are all changes that Intention.js can make to the page based on a user&#39;s device. Context.js creates a set of common page contexts for width thresholds, touch devices, highres displays and a fallback. And you can easily add your own contexts on top of these or create all your own custom contexts.</p>
<h2>What&#39;s included:</h2>
<pre><code>* Intention.js
* Context.js</code></pre>
<p>Intention.js is the script that manages the responsive axis, manipulates elements based on their specifications and emits events when contexts change.</p>
<p>Context.js is an implementation of Intention.js that sets up common use patterns in responsive design.</p>
<p>Specifically it has the responsive contexts:
    <em> base (a catch-all)
    </em> mobile (triggered by width)
    <em> tablet (triggered by width)
    </em> standard (triggered by width)
    <em> touch
    </em> highres</p>
<h2>Installation</h2>
<p>include both scripts on your page or just Intention via require or just straight up.</p>
<pre><code class="lang-html">    &lt;!-- use with context defaults --&gt;
    &lt;script 
        data-main=&quot;assets/js/context&quot; 
        src=&quot;assets/js/require/require.js&quot;&gt;&lt;/script&gt;
    &lt;!-- OR --&gt;
    &lt;!-- use only intention to build your own context --&gt;
    &lt;script src=&quot;Intention.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;Context.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        // your amazing contextual threshold specification here!
    &lt;/script&gt;</code></pre>
<h2>Usage</h2>
<p>By default context.js provides a number of threshold groups via intention.js: browser widths, touch, highres, and a base group</p>
<p>the default thresholds in each group are respectively: 
mobile (320 and below), tablet (321 to 768) and standard (769 to Infinity)
touch (are touch gestures available)
highres (devicePixelRatio &gt; 1)
base (default, always on)</p>
<p>There are three manipulation types: class names, attributes, placement on the page</p>
<h3>Interface</h3>
<pre><code class="lang-html">    &lt;!-- flag the element as responsive --&gt;
    &lt;div intent&gt;
    &lt;!-- or --&gt;
    &lt;div data-intent&gt;
    &lt;!-- For the purposes of the documentation the prefix &quot;in-&quot; will be 
    used instead of &quot;data-in-&quot; to keep things concise --&gt;
    &lt;!-- attribute structure: prefix-context-function 
        ie in-mobile-class OR in-highres-src --&gt;
    &lt;div class=&quot;not interesting&quot; intent in-mobile-class=&quot;more interesting&quot;&gt;</code></pre>
<h4>Attribute Manipulation</h4>
<pre><code class="lang-html">    &lt;!-- mark an element as responsive, set the base(default) attr, specify which image to load in a given context --&gt;
    &lt;img
        intent 
        in-base-src=&quot;small_img.png&quot; 
        in-highres-src=&quot;big_img.png&quot; /&gt;
    &lt;!-- the above spec will produce the following in each context
        default: &lt;img src=&quot;small_img.png&quot; /&gt;
        highres: &lt;img src=&quot;big_img.png&quot; /&gt;
    --&gt;</code></pre>
<h4>Class Manipulation</h4>
<p>An element can have more than one class. intent&#39;s aim is to be as unobtrusive as possible, at the same time allowing for a lot of flexibility with the way classes are combined.</p>
<pre><code class="lang-html">    &lt;section
        class=&quot;column&quot;
        intent
        in-mobile-class=&quot;narrow&quot;
        in-tablet-class=&quot;medium&quot;
        in-standard-class=&quot;wide&quot;
        in-luxury-class=&quot;x-wide&quot;
        in-touch-class=&quot;swipe-nav&quot;
    &gt;...&lt;/section&gt;
    &lt;!--  --&gt;</code></pre>
<h4>Placement Manipulation</h4>
<p>take this html structure</p>
<pre><code class="lang-html">    &lt;header&gt;&lt;nav&gt;&lt;/nav&gt;&lt;/header&gt;
    &lt;section&gt;...&lt;/section&gt;
    &lt;footer&gt;...&lt;/footer&gt;</code></pre>
<p>suppose we want to demote the status of the nav when the user is on smaller devices</p>
<p>the following specification on the nav might do what we need</p>
<pre><code class="lang-html">    &lt;nav intent 
        in-mobile-prepend=&quot;footer&quot;
        in-tablet-append=&quot;section&quot;
        in-standard-append=&quot;header&quot;&gt;</code></pre>
<p>when the device is 320px units or below the nav will appear at the top of the footer. when the device is between 320 and 768 it will go to the end of the section tag, and so forth.</p>
<h5>Move functions</h5>
<pre><code>* prepend
* append
* before
* after</code></pre>
<h4>Why a base context?</h4>
<p>In most scenarios you don&#39;t want to have to specify the way something will change in <em>every</em> context. Often times an element will be one of two things among many different contexts. take an img tag with two possible sources, it&#39;s either going to be highres or not. by specifying the in-highres-src attribute, you know that the source will be appropriately applied in that scenario. With a in-base-src attribute, you can rely on the source being set accordingly for all other contexts.</p>
<h3>Making your own custom contexts</h3>
<p>In addition to what is provided as a set of useful page contexts in the context.js script. You can define your own contexts, for anything!</p>
<p>You can extend the functionality of context.js or scrap the whole thing entirely.</p>
<p>Here is an example for scroll depth thresholds:</p>
<pre><code class="lang-javascript">    var responsiveDepths = intent.responsive(
        // contexts
        [{name:&#39;shallow&#39;, value:20}, {name:&#39;deep&#39;, value:1/0}],
        // matching:
        function(measure, context){
            return measure &lt; context.value;
        },
        // measure
        function(){
            return window.pageYOffset;
        });
    $(window).on(&#39;scroll&#39;, responsiveDepths);</code></pre>
<p>responsiveDepths is just a function, whenever you want to evaluate which context is relevant call that function.</p>
<p>NOTE: if you scrap context.js you will have to add your responsive elements manually via the elements method.</p>
<p>in the above example you could do something like this:</p>
<pre><code class="lang-javascript">    ...
    $(window).on(&#39;scroll&#39;, responsiveDepths);
    intent.elements();</code></pre>
<p>this will add all elements matching the &quot;$(&#39;[data-intent],[intent],[data-in],[in]&#39;)&quot; selector. Optionally pass a scope argument to this function to specify where in the dom to start searching. The default is the document.</p>
<p>calling the elements function will change the elements&#39; attributes to the specification provided in the html as it finds them. This way your responsive axis can all be defined <em>before</em> any changes are made to the DOM.</p>
<h4>The components intent.responsive</h4>
<h5>Thresholds</h5>
<p>The thresholds are an array of context objects. the only requirement of these objects is that they have a name property. Specifying any other property is up to you.</p>
<pre><code class="lang-javascript">    // required
    [{name:&#39;shallow&#39;}, {name:&#39;deep&#39;}]
    // or with a little extra
    [{name:&#39;shallow&#39;, value:20}, 
        {name:&#39;deep&#39;, value: Infinity}]</code></pre>
<h5>Matching function</h5>
<p>The matching function is called for each item in the thresholds array until a match is made i.e. it returns true. it is totally optional. However if it is not specified a default will be used which matches based on the context name. have a look in the Default Compare Functions section for the specifics.</p>
<p>The context that produces a match is then understood as the current context for the threshold group. In other words there will only every be ONE matched context for a threshold group.</p>
<p>If a matching function is not specified this default is used:</p>
<pre><code class="lang-javascript">    function(measure, context){
      return measure === context.name;
    };</code></pre>
<h5>Measure function</h5>
<p>default measure function is a pass-through</p>
<pre><code class="lang-javascript">    function(arg){
      return arg;
    };</code></pre>
<p>why? intent.responsive() // outputs a function. so calling the result of that function with an argument passed to it will get used as the measure arg in the <em>matcher</em> function</p>
<p>like so:</p>
<pre><code class="lang-javascript">    // make a responsive group *thresholds* is the array of contexts and *matcher* is a custom comparison function
    var responsive = intent.responsive(thresholds, matcher);
    // assuming we want to compare the scroll depth against each context you could do something like this:
    responsive(window.pageYOffset);</code></pre>
<p>in this example window.pageYOffset would get passed as the first argument to the matcher function for every context until the matcher returns true.</p>
<h4>Putting it all together</h4>
<p>Threshold objects must be passed to intent.responsive as an array</p>
<p>The only other requirement is that the threshold object has a &quot;name&quot; property, i.e. {name:&#39;slow_page&#39;}. The name is used for two main things: emmiting an event of that name on the intent object and allowing you to create specifications in the html for that threshold.</p>
<pre><code>* names may *not* have dashes
* names can have &quot;_&quot;
* the regex to match them is simply: [_a-zA-Z0-9]+</code></pre>
<p>to create an event handler for a threshold:</p>
<pre><code class="lang-javascript">intent.on(&#39;slow_page&#39;, function(){
    alert(&#39;try another wifi network&#39;);
});</code></pre>
<p>to specify changes to the html when in that threshold</p>
<pre><code class="lang-html">    &lt;img intent in-slow_page-src=&quot;toobad.gif&quot; /&gt;</code></pre>
<h4>Default Compare Functions</h4>
<pre><code class="lang-javascript">    // matching default              
    matcher = function(measure, ctx){
      return measure === ctx.name;
    };
      // measure default is just a pass through
    measure = function(arg){
      return arg;
    };</code></pre>
<h4>About Matching</h4>
<p>top down search, ends when a match is found
in other words just one match per context group</p>
<h3>Stuff to note:</h3>
<h3>Master list of functions:</h3>
<h4>Multi-value attr (union of all current contexts)</h4>
<pre><code>* class</code></pre>
<h4>Move Functions</h4>
<pre><code>* append
* prepend
* before
* after</code></pre>
<h4>Single-value attrs, (everything else)</h4>
<pre><code>* any arbitrary atribute that doesn&#39;t include a dash.</code></pre>
<h2>Authors</h2>
<pre><code>* Joe Kendall
* Erin Sparling</code></pre>
<h2>License</h2>
<pre><code class="lang-javascript">// MIT licesnse for everything

// Copyright (c) 2012 The Wall Street Journal, 
// http://wsj.com/

// Permission is hereby granted, free of charge, to any person obtaining
// a copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to
// permit persons to whom the Software is furnished to do so, subject to
// the following conditions:

// The above copyright notice and this permission notice shall be
// included in all copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
// LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
// OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</code></pre>
